# OS
## é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªä»é›¶å¼€å§‹å®ç°çš„ **x86 æ¶æ„ã€32 ä½ä¿æŠ¤æ¨¡å¼ä¸‹çš„ç®€æ˜“æ“ä½œç³»ç»Ÿå†…æ ¸**ï¼Œä¸»è¦å‚è€ƒã€Šæ“ä½œç³»ç»ŸçœŸç›¸è¿˜åŸã€‹ä¸€ä¹¦å®Œæˆï¼Œç›®æ ‡æ˜¯é€šè¿‡â€œè‡ªå·±åŠ¨æ‰‹å®ç°â€çš„æ–¹å¼ï¼Œæ·±å…¥ç†è§£æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒæœºåˆ¶ï¼Œè€Œéè¿½æ±‚åŠŸèƒ½å®Œå¤‡æˆ–ç”Ÿäº§å¯ç”¨ã€‚

å½“å‰ç³»ç»Ÿå·²å®Œæˆä» **å¼•å¯¼ â†’ å†…æ ¸åˆå§‹åŒ– â†’ ä¸­æ–­ç®¡ç† â†’ çº¿ç¨‹è°ƒåº¦ â†’ ç”¨æˆ·è¿›ç¨‹åˆ‡æ¢** çš„å®Œæ•´é—­ç¯ï¼Œæ“ä½œç³»ç»Ÿå·²ç»å…·å¤‡â€œå¤šæ‰§è¡Œæµ + ç‰¹æƒçº§éš”ç¦»â€çš„åŸºæœ¬å½¢æ€ã€‚

âš ï¸ æœ¬é¡¹ç›® **ä»åœ¨æŒç»­å¼€å‘ä¸­**ï¼Œæ–‡ä»¶ç³»ç»Ÿã€ç¡¬ç›˜é©±åŠ¨ä¸ Shell å°šæœªå®Œæˆã€‚

---

## å·²å®ç°åŠŸèƒ½

### å¯åŠ¨ä¸è¿è¡Œç¯å¢ƒ

* è‡ªåˆ¶ MBR + Loaderï¼Œå¼•å¯¼å†…æ ¸è¿›å…¥ä¿æŠ¤æ¨¡å¼
* å†…æ ¸è¿è¡Œäº 32 ä½ä¿æŠ¤æ¨¡å¼ï¼ˆRing0ï¼‰
* åŸºäº Bochs è™šæ‹Ÿæœºè¿è¡Œä¸è°ƒè¯•

### ä¸­æ–­ä¸å¼‚å¸¸

* IDT åˆå§‹åŒ–
* 8259A å¯ç¼–ç¨‹ä¸­æ–­æ§åˆ¶å™¨
* æ—¶é’Ÿä¸­æ–­ï¼ˆç³»ç»ŸèŠ‚æ‹ï¼‰
* é”®ç›˜ä¸­æ–­
* ä¸­æ–­ä¸Šä¸‹æ–‡ä¿å­˜ä¸æ¢å¤

### å†…å­˜ç®¡ç†

* ç‰©ç†å†…å­˜ä½å›¾ç®¡ç†
* å†…æ ¸é¡µè¡¨åˆå§‹åŒ–
* å†…æ ¸å†…å­˜åˆ†é…
* ç”¨æˆ·è™šæ‹Ÿåœ°å€æ± ç®¡ç†ï¼ˆä¸ºç”¨æˆ·è¿›ç¨‹å‡†å¤‡ï¼‰

### çº¿ç¨‹ä¸è°ƒåº¦

* å†…æ ¸çº¿ç¨‹åˆ›å»ºä¸ç®¡ç†
* çº¿ç¨‹å°±ç»ªé˜Ÿåˆ—
* åŸºäºæ—¶é—´ç‰‡çš„æŠ¢å å¼è°ƒåº¦
* ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆswitch.asmï¼‰

### åŒæ­¥æœºåˆ¶

* è‡ªæ—‹é” / äº’æ–¥é”
* ä¿¡å·é‡
* ä¸´ç•ŒåŒºä¿æŠ¤

### ç»ˆç«¯ä¸è¾“å…¥

* æ§åˆ¶å°è¾“å‡ºï¼ˆconsoleï¼‰
* é”®ç›˜é©±åŠ¨
* IO é˜Ÿåˆ—ï¼ˆé”®ç›˜ç¼“å†²åŒºï¼‰

### ç”¨æˆ·è¿›ç¨‹ï¼ˆå·²å®Œæˆæ ¸å¿ƒï¼‰

* TSS åˆå§‹åŒ–
* ç”¨æˆ·æ€ / å†…æ ¸æ€ç‰¹æƒçº§åˆ‡æ¢ï¼ˆRing3 â†” Ring0ï¼‰
* ç”¨æˆ·è¿›ç¨‹å¯åŠ¨ï¼ˆintr_exit + iretï¼‰
* ç”¨æˆ·è¿›ç¨‹ç‹¬ç«‹æ ˆ
* ç”¨æˆ·è¿›ç¨‹å‚ä¸è°ƒåº¦

---

## æ­£åœ¨å¼€å‘ / æœªå®Œæˆéƒ¨åˆ†

* ç¡¬ç›˜é©±åŠ¨ï¼ˆIDEï¼‰
* æ–‡ä»¶ç³»ç»Ÿ
* Shellï¼ˆç”¨æˆ·äº¤äº’æ¥å£ï¼‰
* ç”¨æˆ·ç¨‹åºåŠ è½½ï¼ˆELF / æ–‡ä»¶å½¢å¼ï¼‰

---

## é¡¹ç›®ç›®å½•ç»“æ„

```
OS/
â”œâ”€â”€ boot/                    # å¯åŠ¨ç›¸å…³ï¼ˆMBR + Loaderï¼‰
â”‚   â”œâ”€â”€ mbr
â”‚   â””â”€â”€ loader
â”‚
â”œâ”€â”€ kernel/                  # å†…æ ¸æ ¸å¿ƒæ¨¡å—ï¼ˆRing0ï¼‰
â”‚   â”œâ”€â”€ main.c               # å†…æ ¸å…¥å£
â”‚   â”œâ”€â”€ init.c               # å†…æ ¸åˆå§‹åŒ–
â”‚   â”œâ”€â”€ interrupt.c          # ä¸­æ–­ç®¡ç†
â”‚   â”œâ”€â”€ memory.c             # å†…å­˜ç®¡ç†
â”‚   â”œâ”€â”€ list.c               # å†…æ ¸é“¾è¡¨
â”‚   â”œâ”€â”€ debug.c              # è°ƒè¯•ä¸æ–­è¨€
â”‚   â””â”€â”€ kernel.asm           # ä¸­æ–­å…¥å£ / æ±‡ç¼–æ”¯æŒ
â”‚
â”œâ”€â”€ device/                  # è®¾å¤‡é©±åŠ¨
â”‚   â”œâ”€â”€ time.c               # æ—¶é’Ÿä¸­æ–­
â”‚   â”œâ”€â”€ keyboard.c           # é”®ç›˜é©±åŠ¨
â”‚   â”œâ”€â”€ console.c            # æ§åˆ¶å°è¾“å‡º
â”‚   â””â”€â”€ ioqueue.c            # IO é˜Ÿåˆ—ï¼ˆé”®ç›˜ç¼“å†²åŒºï¼‰
â”‚
â”œâ”€â”€ thread/                  # çº¿ç¨‹ä¸åŒæ­¥æœºåˆ¶ï¼ˆå†…æ ¸æ€ï¼‰
â”‚   â”œâ”€â”€ thread.c             # çº¿ç¨‹ç®¡ç†ä¸è°ƒåº¦
â”‚   â”œâ”€â”€ sync.c               # é” / ä¿¡å·é‡
â”‚   â””â”€â”€ switch.asm           # ä¸Šä¸‹æ–‡åˆ‡æ¢
â”‚
â”œâ”€â”€ userprog/                # ç”¨æˆ·è¿›ç¨‹æ”¯æŒï¼ˆå†…æ ¸ä¾§ï¼‰
â”‚   â”œâ”€â”€ process.c            # ç”¨æˆ·è¿›ç¨‹åˆ›å»ºä¸åˆ‡æ¢
â”‚   â”œâ”€â”€ tss.c                # TSS åˆå§‹åŒ–
â”‚   â””â”€â”€ syscall-init.c       # ç³»ç»Ÿè°ƒç”¨åˆå§‹åŒ–
â”‚
â”œâ”€â”€ lib/                     # åŸºç¡€åº“
â”‚   â”œâ”€â”€ bitmap.c             # ä½å›¾
â”‚   â”œâ”€â”€ string.c             # å­—ç¬¦ä¸²æ“ä½œ
â”‚   â”œâ”€â”€ print.asm            # å†…æ ¸æ‰“å°
â”‚   â””â”€â”€ user/                # ç”¨æˆ·æ€åº“
â”‚       â”œâ”€â”€ syscall.c        # ç³»ç»Ÿè°ƒç”¨å°è£…
â”‚       â””â”€â”€ stdio.c          # ç”¨æˆ·æ€ printf ç­‰
â”‚
â”œâ”€â”€ include/                 # å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ kernel/              # å†…æ ¸å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ device/              # è®¾å¤‡ç›¸å…³å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ thread/              # çº¿ç¨‹ä¸åŒæ­¥
â”‚   â”œâ”€â”€ userprog/            # ç”¨æˆ·è¿›ç¨‹ / TSS / syscall
â”‚   â”œâ”€â”€ user/                # ç”¨æˆ·æ€æ¥å£ï¼ˆsyscall / stdioï¼‰
â”‚   â””â”€â”€ lib/                 # åŸºç¡€åº“å¤´æ–‡ä»¶
â”‚
â”œâ”€â”€ note/                    # å­¦ä¹ ä¸å®ç°ç¬”è®°
â”‚
â”œâ”€â”€ build/                   # ç¼–è¯‘äº§ç‰©
â”‚ 
â”‚
â”œâ”€â”€ Makefile
â””â”€â”€ README.md

```

---

## æ„å»ºä¸è¿è¡Œç¯å¢ƒ

### 1. æ¨èç¯å¢ƒ

* Linuxï¼ˆUbuntu 20.04+ / Arch Linuxï¼‰
* x86_64 ä¸»æœº

### 2. ä½¿ç”¨ Dockerï¼ˆæ¨èï¼‰

é¿å…å®¿ä¸»æœº 32 ä½å·¥å…·é“¾é—®é¢˜ï¼Œå¯ä½¿ç”¨ Docker æ„å»ºç¯å¢ƒï¼š

* gcc (æ”¯æŒ -m32)
* nasm
* ld (elf_i386)
* make

> é¡¹ç›®åœ¨ Docker å®¹å™¨å†…å®Œæˆç¼–è¯‘ï¼ŒBochs åœ¨å®¿ä¸»æœºè¿è¡Œã€‚

### 3. ä¾èµ–å·¥å…·

* gcc (æ”¯æŒ 32 ä½ç¼–è¯‘)
* nasm
* binutils (ld)
* make
* bochs

---

## ç¼–è¯‘æ–¹å¼

```bash
make        # æ„å»ºå†…æ ¸
make clean  # æ¸…ç† build ç›®å½•
```

ç”Ÿæˆæ–‡ä»¶ï¼š

```
build/kernel.bin
```

---

## è¿è¡Œæ–¹å¼ï¼ˆBochsï¼‰

1. é…ç½® bochsrcï¼Œå°† kernel.bin å†™å…¥è™šæ‹Ÿç¡¬ç›˜
2. å¯åŠ¨ Bochs
3. å†…æ ¸å¯åŠ¨åå¯çœ‹åˆ°ï¼š
   * ä¸­æ–­åˆå§‹åŒ–ä¿¡æ¯
   * é”®ç›˜åˆå§‹åŒ–å®Œæˆ
   * ç”¨æˆ·è¿›ç¨‹åˆ‡æ¢ç›¸å…³è¾“å‡º


## å½“å‰çŠ¶æ€

ğŸš§ **å¼€å‘ä¸­ï¼ˆUnder Constructionï¼‰**

åç»­å°†ç»§ç»­å®ç°ï¼š

* æ–‡ä»¶ç³»ç»Ÿ
* Shell
---


