# OS

## 项目简介

这是一个从零开始实现的 **x86 架构、32 位保护模式下的简易操作系统内核**，主要参考《操作系统真相还原》一书完成，目标是通过“自己动手实现”的方式，深入理解操作系统的核心机制。

当前系统已完成从  
**引导 → 内核初始化 → 中断管理 → 内存管理 → 线程调度 → 用户进程切换 → 硬盘访问**  
的完整执行链路。

⚠️ 本项目 **仍在持续开发中**，文件系统与 Shell 尚未完成。

---

## 已实现功能

### 启动与运行环境

* 自制 MBR + Loader，引导内核进入保护模式
* 内核运行于 32 位保护模式（Ring0）
* 基于 Bochs 虚拟机运行与调试

### 中断与异常

* IDT 初始化
* 8259A 可编程中断控制器
* 时钟中断（系统节拍）
* 键盘中断
* 中断上下文保存与恢复

### 内存管理

* 物理内存位图管理
* 内核页表初始化
* 内核内存分配
* 用户虚拟地址池管理（为用户进程准备）

### 线程与调度

* 内核线程创建与管理
* 线程就绪队列
* 基于时间片的抢占式调度
* 上下文切换（switch.asm）

### 同步机制

* 自旋锁 / 互斥锁
* 信号量
* 临界区保护

### 终端与输入

* 控制台输出（console）
* 键盘驱动
* IO 队列（键盘缓冲区）

### 用户进程（已完成核心）

* TSS 初始化
* 用户态 / 内核态特权级切换（Ring3 ↔ Ring0）
* 用户进程启动（intr_exit + iret）
* 用户进程独立栈
* 用户进程参与调度

### 硬盘驱动（IDE）

* ATA PIO 模式硬盘驱动
* 硬盘初始化与识别
* 扇区级读写接口
* 同步阻塞式访问
* 作为文件系统的底层存储抽象

---

## 正在开发 / 未完成部分

* 文件系统
* Shell（用户交互接口）
* 用户程序加载（ELF / 文件形式）

---

## 项目架构
```
OS/
├── boot/ # 启动相关（MBR + Loader）
│ ├── mbr
│ └── loader
│
├── kernel/ # 内核核心模块（Ring0）
│ ├── main.c # 内核入口
│ ├── init.c # 内核初始化
│ ├── interrupt.c # 中断管理
│ ├── memory.c # 内存管理
│ ├── list.c # 内核链表
│ ├── debug.c # 调试与断言
│ └── kernel.asm # 中断入口 / 汇编支持
│
├── device/ # 设备驱动
│ ├── time.c # 时钟中断
│ ├── keyboard.c # 键盘驱动
│ ├── console.c # 控制台输出
│ ├── ioqueue.c # IO 队列
│ └── ide.c # 硬盘驱动（IDE）
│
├── thread/ # 线程与同步机制（内核态）
│ ├── thread.c # 线程管理与调度
│ ├── sync.c # 锁 / 信号量
│ └── switch.asm # 上下文切换
│
├── userprog/ # 用户进程支持（内核侧）
│ ├── process.c # 用户进程创建与切换
│ ├── tss.c # TSS 初始化
│ └── syscall-init.c # 系统调用初始化
│
├── lib/ # 基础库
│ ├── bitmap.c # 位图
│ ├── string.c # 字符串操作
│ ├── print.asm # 内核打印
│ └── user/ # 用户态库
│ ├── syscall.c # 系统调用封装
│ └── stdio.c # 用户态 printf 等
│
├── include/ # 头文件
│ ├── kernel/
│ ├── device/
│ ├── thread/
│ ├── userprog/
│ ├── user/
│ └── lib/
│
├── note/ # 学习与实现笔记
├── build/ # 编译产物
│
├── Makefile
└── README.md
```

---

## 当前状态

🚧 **开发中（Under Construction）**

下一阶段计划：

* 基于 IDE 驱动实现文件系统
* 构建 Shell，实现用户态交互

---

